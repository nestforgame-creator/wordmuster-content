{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wordmuster.dev/schemas/legacyMap.schema.json",
  "title": "Legacy Map Schema (Nodes + Sublevels)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "dataVersion",
    "generatedOn",
    "mapId",
    "mode",
    "variant",
    "assets",
    "rendering",
    "unlockModel",
    "nodes"
  ],
  "properties": {
    "dataVersion": { "type": "string", "minLength": 1 },
    "generatedOn": { "type": "string", "format": "date-time" },
    "mapId": { "type": "string", "minLength": 1 },

    "mode": { "type": "string", "enum": ["challenge"] },
    "variant": { "type": "string", "enum": ["legacy"] },

    "assets": {
      "type": "object",
      "additionalProperties": false,
      "required": ["backgrounds", "letters", "ui"],
      "properties": {
        "backgrounds": {
          "type": "object",
          "additionalProperties": false,
          "required": ["day_1x", "day_2x", "night_1x", "night_2x"],
          "properties": {
            "day_1x": { "type": "string", "minLength": 1 },
            "day_2x": { "type": "string", "minLength": 1 },
            "night_1x": { "type": "string", "minLength": 1 },
            "night_2x": { "type": "string", "minLength": 1 }
          }
        },
        "letters": {
          "type": "object",
          "additionalProperties": false,
          "required": ["lettersRoot", "filePattern", "themes"],
          "properties": {
            "lettersRoot": { "type": "string", "minLength": 1 },
            "filePattern": { "type": "string", "minLength": 1 },
            "themes": {
              "type": "array",
              "minItems": 1,
              "uniqueItems": true,
              "items": { "type": "string", "enum": ["day", "night"] }
            }
          }
        },
        "ui": {
          "type": "object",
          "additionalProperties": false,
          "required": ["tile_base_2x", "lock_2x", "star_empty_2x", "star_filled_2x"],
          "properties": {
            "tile_base_2x": { "type": "string", "minLength": 1 },
            "lock_2x": { "type": "string", "minLength": 1 },
            "star_empty_2x": { "type": "string", "minLength": 1 },
            "star_filled_2x": { "type": "string", "minLength": 1 }
          }
        }
      }
    },

    "rendering": {
      "type": "object",
      "additionalProperties": false,
      "required": ["coordinateSystem", "tileAnchor", "tileScale", "minTapRadius", "safeMargins"],
      "properties": {
        "coordinateSystem": { "type": "string", "enum": ["normalized_percent"] },
        "tileAnchor": { "type": "string", "enum": ["center"] },
        "tileScale": { "type": "number", "minimum": 0.01, "maximum": 0.5 },
        "minTapRadius": { "type": "number", "minimum": 0.01, "maximum": 0.2 },
        "safeMargins": {
          "type": "object",
          "additionalProperties": false,
          "required": ["top", "right", "bottom", "left"],
          "properties": {
            "top": { "type": "number", "minimum": 0.0, "maximum": 0.25 },
            "right": { "type": "number", "minimum": 0.0, "maximum": 0.25 },
            "bottom": { "type": "number", "minimum": 0.0, "maximum": 0.25 },
            "left": { "type": "number", "minimum": 0.0, "maximum": 0.25 }
          }
        }
      }
    },

    "unlockModel": {
      "type": "object",
      "additionalProperties": false,
      "required": ["nodeRule", "subLevelRule", "economyDefaults"],
      "properties": {
        "nodeRule": {
          "type": "object",
          "additionalProperties": false,
          "required": ["requiresPreviousNode", "minStarsToUnlockNextNode", "coinBypassEnabled"],
          "properties": {
            "requiresPreviousNode": { "type": "boolean" },
            "minStarsToUnlockNextNode": { "type": "integer", "minimum": 0, "maximum": 3 },
            "coinBypassEnabled": { "type": "boolean" }
          }
        },
        "subLevelRule": {
          "type": "object",
          "additionalProperties": false,
          "required": ["requiresPreviousSubLevel", "minStarsToUnlockNextSubLevel"],
          "properties": {
            "requiresPreviousSubLevel": { "type": "boolean" },
            "minStarsToUnlockNextSubLevel": { "type": "integer", "minimum": 0, "maximum": 3 }
          }
        },
        "economyDefaults": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "entryCostCoins",
            "nodeUnlockBypassCostCoins",
            "subLevelUnlockBypassCostCoins",
            "rewardCoinsOnComplete"
          ],
          "properties": {
            "entryCostCoins": { "type": "integer", "minimum": 0 },
            "nodeUnlockBypassCostCoins": { "type": "integer", "minimum": 0 },
            "subLevelUnlockBypassCostCoins": { "type": "integer", "minimum": 0 },
            "rewardCoinsOnComplete": { "type": "integer", "minimum": 0 }
          }
        }
      }
    },

    "nodes": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["nodeId", "order", "letter", "mapTile", "unlock", "subLevels"],
        "properties": {
          "nodeId": { "type": "string", "pattern": "^[A-Z]$" },
          "order": { "type": "integer", "minimum": 1 },
          "letter": { "type": "string", "pattern": "^[A-Z]$" },

          "mapTile": {
            "type": "object",
            "additionalProperties": false,
            "required": ["x", "y"],
            "properties": {
              "x": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
              "y": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
            }
          },

          "unlock": {
            "type": "object",
            "additionalProperties": false,
            "required": ["requiresNodeId", "bypassCostCoins"],
            "properties": {
              "requiresNodeId": { "type": ["string", "null"], "pattern": "^[A-Z]$" },
              "bypassCostCoins": { "type": "integer", "minimum": 0 }
            }
          },

          "subLevels": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["subLevelId", "sequence", "difficultyBand", "timerSeconds", "boardRef", "unlock"],
              "properties": {
                "subLevelId": { "type": "string", "pattern": "^[A-Z][0-9]{2}$" },
                "sequence": { "type": "integer", "minimum": 1 },
                "difficultyBand": { "type": "string", "enum": ["EASY", "MEDIUM", "HARD", "PRO"] },
                "timerSeconds": { "type": "integer", "enum": [30, 60, 90] },

                "boardRef": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["type", "difficultyBand", "timerSeconds"],
                  "properties": {
                    "type": { "type": "string", "enum": ["filter"] },
                    "difficultyBand": { "type": "string", "enum": ["EASY", "MEDIUM", "HARD", "PRO"] },
                    "timerSeconds": { "type": "integer", "enum": [30, 60, 90] }
                  }
                },

                "unlock": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["requiresSubLevelId"],
                  "properties": {
                    "requiresSubLevelId": { "type": ["string", "null"], "pattern": "^[A-Z][0-9]{2}$" }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
