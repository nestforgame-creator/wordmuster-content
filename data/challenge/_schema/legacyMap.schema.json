{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wordmuster.dev/schemas/legacyMap.schema.json",
  "title": "Legacy Map Schema",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "dataVersion",
    "generatedOn",
    "mapId",
    "mode",
    "assets",
    "rendering",
    "unlockModel",
    "levels"
  ],
  "properties": {
    "dataVersion": { "type": "string", "minLength": 1 },
    "generatedOn": { "type": "string", "format": "date-time" },
    "mapId": { "type": "string", "minLength": 1 },
    "mode": { "type": "string", "enum": ["challenge_legacy"] },

    "assets": {
      "type": "object",
      "additionalProperties": false,
      "required": ["backgrounds", "letters", "ui"],
      "properties": {
        "backgrounds": {
          "type": "object",
          "additionalProperties": false,
          "required": ["day_1x", "day_2x", "night_1x", "night_2x"],
          "properties": {
            "day_1x": { "type": "string", "minLength": 1 },
            "day_2x": { "type": "string", "minLength": 1 },
            "night_1x": { "type": "string", "minLength": 1 },
            "night_2x": { "type": "string", "minLength": 1 }
          }
        },

        "letters": {
          "type": "object",
          "minProperties": 1,
          "propertyNames": { "pattern": "^[A-Z]_(day|night)_(1x|2x)$" },
          "additionalProperties": { "type": "string", "minLength": 1 }
        },

        "ui": {
          "type": "object",
          "additionalProperties": false,
          "required": ["tile_base_2x", "lock_2x", "star_empty_2x", "star_filled_2x"],
          "properties": {
            "tile_base_2x": { "type": "string", "minLength": 1 },
            "lock_2x": { "type": "string", "minLength": 1 },
            "star_empty_2x": { "type": "string", "minLength": 1 },
            "star_filled_2x": { "type": "string", "minLength": 1 }
          }
        }
      }
    },

    "rendering": {
      "type": "object",
      "additionalProperties": false,
      "required": ["coordinateSystem", "tileAnchor", "tileScale", "minTapRadius", "safeMargins"],
      "properties": {
        "coordinateSystem": { "type": "string", "enum": ["normalized_percent"] },
        "tileAnchor": { "type": "string", "enum": ["center"] },
        "tileScale": { "type": "number", "minimum": 0.01, "maximum": 0.5 },
        "minTapRadius": { "type": "number", "minimum": 0.01, "maximum": 0.2 },
        "safeMargins": {
          "type": "object",
          "additionalProperties": false,
          "required": ["top", "right", "bottom", "left"],
          "properties": {
            "top": { "type": "number", "minimum": 0.0, "maximum": 0.25 },
            "right": { "type": "number", "minimum": 0.0, "maximum": 0.25 },
            "bottom": { "type": "number", "minimum": 0.0, "maximum": 0.25 },
            "left": { "type": "number", "minimum": 0.0, "maximum": 0.25 }
          }
        }
      }
    },

    "unlockModel": {
      "type": "object",
      "additionalProperties": false,
      "required": ["defaultRule", "economy"],
      "properties": {
        "defaultRule": {
          "type": "object",
          "additionalProperties": false,
          "required": ["requiresPreviousLevel", "minStarsToUnlockNext", "coinBypassEnabled"],
          "properties": {
            "requiresPreviousLevel": { "type": "boolean" },
            "minStarsToUnlockNext": { "type": "integer", "minimum": 0, "maximum": 3 },
            "coinBypassEnabled": { "type": "boolean" }
          }
        },
        "economy": {
          "type": "object",
          "additionalProperties": false,
          "required": ["entryCostCoins", "unlockBypassCostCoins", "rewardCoinsOnComplete"],
          "properties": {
            "entryCostCoins": { "type": "integer", "minimum": 0 },
            "unlockBypassCostCoins": { "type": "integer", "minimum": 0 },
            "rewardCoinsOnComplete": { "type": "integer", "minimum": 0 }
          }
        }
      }
    },

    "levels": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "levelId",
          "letter",
          "sequence",
          "boardRef",
          "difficulty",
          "timer",
          "assets",
          "mapTile",
          "unlock"
        ],
        "properties": {
          "levelId": { "type": "string", "minLength": 1 },
          "letter": { "type": "string", "pattern": "^[A-Z]$" },
          "sequence": { "type": "integer", "minimum": 1 },

          "boardRef": {
            "type": "object",
            "additionalProperties": false,
            "required": ["type", "value"],
            "properties": {
              "type": { "type": "string", "enum": ["boardPoolId", "boardId"] },
              "value": { "type": "string", "minLength": 1 }
            }
          },

          "difficulty": { "type": "string", "enum": ["EASY", "MEDIUM", "HARD", "PRO"] },
          "timer": { "type": "integer", "enum": [30, 60, 90] },

          "assets": {
            "type": "object",
            "additionalProperties": false,
            "required": ["day", "night"],
            "properties": {
              "day": { "type": "string", "minLength": 1 },
              "night": { "type": "string", "minLength": 1 }
            }
          },

          "mapTile": {
            "type": "object",
            "additionalProperties": false,
            "required": ["x", "y"],
            "properties": {
              "x": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
              "y": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
            }
          },

          "unlock": {
            "type": "object",
            "additionalProperties": false,
            "required": ["requiresLevelId", "bypassCostCoins"],
            "properties": {
              "requiresLevelId": { "type": ["string", "null"], "minLength": 1 },
              "bypassCostCoins": { "type": "integer", "minimum": 0 }
            }
          }
        }
      }
    }
  }
}

